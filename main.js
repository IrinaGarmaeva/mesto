(()=>{"use strict";document.querySelector(".profile__avatar");const e=document.querySelector(".button_type_edit-avatar"),t=document.querySelector(".button_type_edit-profile"),s=document.querySelector(".button_type_add"),r=document.querySelector(".popup__input_el_name"),n=document.querySelector(".popup__input_el_job");class i{constructor({data:e,templateSelector:t,userId:s,handleCardClick:r,handleLikeClick:n,handleDeleteIconClick:i}){this._name=e.name,this._link=e.link,this._likes=e.likes,this.cardId=e._id,this._templateSelector=t,this._userId=s,this._handleCardClick=r,this._ownerId=e.owner._id,this.handleLikeClick=n,this.handleDeleteIconClick=i}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".place").cloneNode(!0)}addCardLike(){this._buttonLike.classList.add("place__like-button_active"),this.isLiked=!0}removeCardLike(){this._buttonLike.classList.remove("place__like-button_active"),this.isLiked=!1}countLikes(e){this._elementLikesCounter.textContent=e.likes.length}isLiked(){return this._likes.some((e=>e._id===this._userId))}_toggleLike(){this.isLiked?this.removeCardLike():this.addCardLike()}removeCard(){this._element.remove()}_setEventListeners(){this._buttonLike.addEventListener("click",(()=>{this.handleLikeClick(this)})),this._buttonDeleteBasket.addEventListener("click",(()=>{this.handleDeleteIconClick(this)})),this._cardImage.addEventListener("click",(()=>{this._handleCardClick(this._name,this._link)}))}generateCard(){return this._element=this._getTemplate(),this._buttonLike=this._element.querySelector(".place__like-button"),this._buttonDeleteBasket=this._element.querySelector(".place__delete-button"),this._cardImage=this._element.querySelector(".place__photo"),this._cardImage.src=this._link,this._element.querySelector(".place__name").textContent=this._name,this._cardImage.alt=this._name,this._toggleLike(),this._elementLikesCounter=this._element.querySelector(".place__like-button__counter"),this._elementLikesCounter.textContent=this._likes.length,this._ownerId!==this._userId&&this._buttonDeleteBasket.remove(),this._setEventListeners(),this._element}}class o{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._errorClass=e.errorClass,this._inpitErrorClass=e.inpitErrorClass,this._formListSelector=e.formSelector,this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonSubmit=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e){const t=this._formElement.querySelector(`.${e.name}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`.${e.name}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}disableButton(){this._buttonSubmit.setAttribute("disabled","disabled"),this._buttonSubmit.classList.add(this._inactiveButtonClass)}enableButton(){this._buttonSubmit.removeAttribute("disabled"),this._buttonSubmit.classList.remove(this._inactiveButtonClass)}_toggleButtonState(){this._hasInvalidInput()?this.disableButton():this.enableButton()}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}clearInputError(){this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}class a{constructor(e){this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class c extends a{constructor({popupSelector:e,callbackSubmitForm:t}){super(e),this._callbackSubmitForm=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._popup.querySelectorAll(".popup__input"),this._buttonSubmit=this._form.querySelector(".popup__button")}renderLoading(e){this._buttonSubmit.textContent=e?"Сохранение...":"Сохранить"}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._callbackSubmitForm(this._getInputValues()),this.close()}))}close(){super.close(),this._form.reset()}}let l;const u=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}async getUserData(){const e=await fetch(`${this._baseUrl}/users/me`,{headers:this._headers});return this._checkResponse(e)}async getInitialCards(){const e=await fetch(`${this._baseUrl}/cards`,{headers:this._headers});return this._checkResponse(e)}async editUserData({newName:e,newAbout:t}){const s=await fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})});return this._checkResponse(s)}async addNewCard({newName:e,newLink:t}){const s=await fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})});return this._checkResponse(s)}async deleteCard(e){const t=await fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers});return this._checkResponse(t)}async putLike(e){const t=await fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers});return this._checkResponse(t)}async deleteLike(e){const t=await fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers});return this._checkResponse(t)}async setUserAvatar({link:e}){const t=await fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})});return this._checkResponse(t)}}({baseUrl:"https://nomoreparties.co/v1/cohort-65",headers:{authorization:"1ddaccfd-6cdb-4497-bcf7-c6a054674d3b","Content-Type":"application/json"}});Promise.all([u.getUserData(),u.getInitialCards()]).then((([e,t])=>{p.setUserInfo({newUserName:e.name,newUserOccupation:e.about}),p.setUserAvatar(e.avatar),l=e._id,v.renderItems(t)}));const p=new class{constructor({userNameSelector:e,userOccupationSelector:t,avatarSelector:s}){this._userName=document.querySelector(e),this._userOccupation=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._userName.textContent,occupation:this._userOccupation.textContent,avatar:this._avatar.src}}setUserInfo({newUserName:e,newUserOccupation:t}){this._userName.textContent=e,this._userOccupation.textContent=t}setUserAvatar(e){this._avatar.src=e}}({userNameSelector:".profile__name",userOccupationSelector:".profile__about",avatarSelector:".profile__avatar"}),h=new c({popupSelector:".popup_type_edit-profile",callbackSubmitForm:e=>{const{"popup-username":t,"popup-job":s}=e;h.renderLoading(!0),u.editUserData({newName:t,newAbout:s}).then((()=>p.setUserInfo({newUserName:t,newUserOccupation:s}))).catch((e=>console.log("Ошибка редактирования информации о пользователе:",e)))}});h.setEventListeners(),t.addEventListener("click",(()=>{h.open(),h.renderLoading(!1);const{name:e,occupation:t}=p.getUserInfo();r.value=e,n.value=t,S["profile-form"].clearInputError(),S["profile-form"].enableButton()}));const _=new c({popupSelector:".popup_type_add-place",callbackSubmitForm:e=>{const{"card-name":t,"card-link":s}=e;_.renderLoading(!0),u.addNewCard({newName:t,newLink:s}).then((e=>L(e))).catch((e=>console.log("Ошибка добавления новой карточки:",e)))}});_.setEventListeners(),s.addEventListener("click",(()=>{_.open(),_.renderLoading(!1),S["place-form"].clearInputError(),S["place-form"].disableButton()}));const d=new class extends a{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__photo"),this._popupHeading=this._popup.querySelector(".popup__heading")}open({name:e,link:t}){super.open(),this._popupImage.src=t,this._popupHeading.textContent=e,this._popupImage.alt=e}}(".popup_type_open-image");d.setEventListeners();const m=new c({popupSelector:".popup_type_update-avatar",callbackSubmitForm:e=>{const{"avatar-link":t}=e;m.renderLoading(!0),u.setUserAvatar({link:t}).then((e=>p.setUserAvatar(e.avatar))).catch((e=>console.log("Ошибка редактирования аватара пользователя:",e)))}});m.setEventListeners(),e.addEventListener("click",(()=>{m.open(),m.renderLoading(!1),S["avatar-form"].clearInputError(),S["avatar-form"].disableButton()}));const k=new class extends a{constructor({popupSelector:e}){super(e),this._form=this._popup.querySelector(".popup__form")}setSubmitAction(e){this._submitForm=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitForm()}))}}({popupSelector:".popup_type_confirm"});function b(e){k.open(),k.setSubmitAction((function(){u.deleteCard(e.cardId).then((()=>{e.removeCard(),k.close()})).catch((e=>console.log("Ошибка удаления карточки:",e)))}))}k.setEventListeners();const v=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderItems(e){e.reverse().forEach((e=>{this._renderer(e)}))}}({renderer:L},".places");function L(e){const t=new i({data:e,templateSelector:"#cardTemplate",userId:l,handleCardClick:()=>{d.open({name:e.name,link:e.link})},handleLikeClick:f,handleDeleteIconClick:b}).generateCard();v.addItem(t)}const S={};function f(e){e.isLiked?u.deleteLike(e.cardId).then((t=>{e.removeCardLike(),e.countLikes(t)})).catch((e=>console.log("Ошибка удаления лайка:",e))):u.putLike(e.cardId).then((t=>{e.addCardLike(),e.countLikes(t)})).catch((e=>console.log("Ошибка постановки лайка:",e)))}var C;C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",errorClass:"popup__input-error_active",inputErrorClass:"popup__input_invalid"},Array.from(document.querySelectorAll(C.formSelector)).forEach((e=>{const t=new o(C,e),s=e.getAttribute("name");S[s]=t,t.enableValidation()}))})();
//# sourceMappingURL=main.js.map